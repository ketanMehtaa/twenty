---
title: Backend Modules
info: Comprehensive documentation of all backend modules in twenty-server
icon: TbComponents
image: /images/user-guide/fields/field.png
---

This guide provides comprehensive documentation for all backend modules in the Twenty CRM system. Each module encapsulates specific business logic and features following NestJS best practices.

## Module Architecture Overview

The Twenty backend follows a modular architecture where each module represents a distinct feature or domain. All modules are located in `packages/twenty-server/src/modules/` and are imported into the main `ModulesModule`.

```
modules/
├── attachment/              # File attachments
├── blocklist/              # Contact/domain blocking
├── calendar/               # Calendar synchronization
├── company/                # Company entities
├── connected-account/      # External account connections
├── contact-creation-manager/ # Contact automation
├── dashboard/              # Dashboard widgets
├── favorite/               # Favorites management
├── favorite-folder/        # Favorite folders
├── match-participant/      # Participant matching
├── messaging/              # Email/message sync
├── note/                   # Notes management
├── opportunity/            # Sales opportunities
├── person/                 # Person/contact entities
├── task/                   # Task management
├── timeline/               # Activity timeline
├── view/                   # Custom views & filters
├── workflow/               # Workflow automation
└── workspace-member/       # Workspace members
```

## Core Modules

### Calendar Module

**Purpose**: Manages calendar events and synchronization with external calendar providers (Google Calendar, Microsoft Calendar, CalDAV).

**Location**: `src/modules/calendar/`

**Key Components**:
- `CalendarEventImportManagerModule` - Imports calendar events from external providers
- `CalendarEventCleanerModule` - Cleans up old or orphaned calendar events
- `CalendarEventParticipantManagerModule` - Manages event participants and attendees
- `CalendarBlocklistManagerModule` - Handles blocked calendar contacts
- `CalendarCommonModule` - Shared calendar utilities and services

**Submodules**:
- **Calendar Event Import Manager**: Handles importing events from various calendar providers
  - `drivers/google-calendar/` - Google Calendar API integration
  - `drivers/microsoft-calendar/` - Microsoft Calendar API integration
  - `drivers/caldav/` - CalDAV protocol support
  - Services: Event fetching, saving, and exception handling

**Use Cases**:
- Sync calendar events from external providers
- Display user calendar events in the CRM
- Manage meeting participants and attendees
- Handle calendar event notifications

---

### Messaging Module

**Purpose**: Manages email and message synchronization from external email providers (Gmail, Outlook, IMAP).

**Location**: `src/modules/messaging/`

**Key Components**:
- `MessagingImportManagerModule` - Core message import functionality
- `MessagingMessageCleanerModule` - Cleans up messages and maintains data hygiene
- `MessageParticipantManagerModule` - Manages email participants and threads
- `MessagingBlocklistManagerModule` - Handles blocked email addresses
- `MessagingMonitoringModule` - Monitors messaging system health and performance

**Submodules**:
- **Message Import Manager**: Comprehensive email import system
  - `drivers/gmail/` - Gmail API integration
  - `drivers/microsoft/` - Microsoft Graph API for Outlook
  - `drivers/imap/` - IMAP protocol support
  - Cron jobs for scheduled imports
  - Services for message parsing and storage

- **Message Folder Manager**: Manages email folder structure
  - Syncs folder hierarchies from external providers
  - Maps external folders to internal structure

**Use Cases**:
- Sync emails from connected accounts
- Display email threads in contact timelines
- Track email communications with leads/customers
- Monitor email engagement

---

### Workflow Module

**Purpose**: Provides workflow automation capabilities, including triggers, actions, and execution engine.

**Location**: `src/modules/workflow/`

**Key Components**:
- `WorkflowBuilderModule` - Visual workflow builder and schema management
- `WorkflowExecutorModule` - Executes workflow actions
- `WorkflowRunnerModule` - Manages workflow runs and execution queue
- `WorkflowTriggerModule` - Handles workflow triggers (manual, automated)
- `WorkflowStatusModule` - Tracks workflow execution status
- `WorkflowToolsModule` - Provides workflow utility functions
- `WorkflowCommonModule` - Shared workflow utilities

**Submodules**:

**Workflow Builder**:
- `WorkflowVersionModule` - Manages workflow versions
- `WorkflowVersionStepModule` - Individual workflow steps
- `WorkflowVersionEdgeModule` - Connections between steps
- `WorkflowSchemaModule` - Workflow schema validation

**Workflow Executor**:
- **Actions**: Different types of workflow actions
  - `ai-agent/` - AI-powered actions
  - `code/` - Custom code execution
  - `filter/` - Conditional logic
  - `form/` - Form submissions
  - `iterator/` - Loop through items
  - `record-crud/` - Create, read, update, delete records
  - `empty/` - Placeholder actions

**Workflow Runner**:
- `WorkflowRunModule` - Individual workflow run management
- `WorkflowRunQueueModule` - Queue for workflow execution using BullMQ

**Workflow Trigger**:
- `AutomatedTriggerModule` - Database-based triggers
- Query hooks for triggering workflows on data changes

**Use Cases**:
- Automate repetitive tasks
- Create custom business logic flows
- Trigger actions based on data changes
- Build complex multi-step processes

---

### Connected Account Module

**Purpose**: Manages external account connections (email, calendar) and OAuth authentication.

**Location**: `src/modules/connected-account/`

**Key Components**:
- `AccountsToReconnectService` - Identifies accounts needing re-authentication
- `ConnectedAccountListener` - Listens to account events
- `ConnectedAccountWorkspaceMemberListener` - Handles workspace member account changes
- `DeleteWorkspaceMemberConnectedAccountsCleanupJob` - Cleanup job for deleted accounts

**Submodules**:
- **OAuth2 Client Manager**: Manages OAuth2 authentication flows
  - Token acquisition and refresh
  - Provider-specific OAuth implementations

- **Refresh Tokens Manager**: Handles token refresh logic
  - Automatic token renewal
  - Token expiration management

- **Email Alias Manager**: Manages email aliases for sending
  - Configure send-as addresses
  - Verify email ownership

- **IMAP API**: Direct IMAP protocol support
  - Alternative to API-based email access
  - Self-hosted email server support

**Use Cases**:
- Connect Gmail/Outlook accounts
- Manage OAuth tokens and refresh
- Handle account disconnections
- Support multiple connected accounts per user

---

### View Module

**Purpose**: Manages custom views, filters, sorts, and field configurations for data tables.

**Location**: `src/modules/view/`

**Key Components**:
- View entities (ViewEntity, ViewFieldEntity, ViewFilterEntity, etc.)
- Integration with ObjectMetadataEntity for dynamic views
- Feature flag support for view capabilities

**Features**:
- **ViewEntity**: Stores view configurations
- **ViewFieldEntity**: Defines which fields are visible in a view
- **ViewFilterEntity**: Stores filter conditions
- **ViewFilterGroupEntity**: Groups multiple filters with AND/OR logic
- **ViewSortEntity**: Defines sort order
- **ViewGroupEntity**: Defines grouping logic

**Use Cases**:
- Create custom table views
- Save filter and sort configurations
- Share views across workspace members
- Personalize data display per user

---

### Favorite Module

**Purpose**: Manages user favorites for quick access to records.

**Location**: `src/modules/favorite/`

**Key Components**:
- Standard objects for favorite records
- Services for managing favorites
- Listeners for favorite events
- Background jobs for cleanup

**Features**:
- Add/remove favorites
- Organize favorites in folders
- Quick access to frequently used records

**Use Cases**:
- Mark important contacts as favorites
- Quick access to active deals
- Organize frequently accessed records

---

### Favorite Folder Module

**Purpose**: Organizes favorites into hierarchical folder structures.

**Location**: `src/modules/favorite-folder/`

**Key Components**:
- Standard objects for folder definitions
- Listeners for folder operations

**Use Cases**:
- Create folder hierarchies for favorites
- Organize favorites by project or category
- Share favorite folders across team

---

## Data Management Modules

### Company Module

**Purpose**: Manages company/organization entities in the CRM.

**Location**: `src/modules/company/`

**Features**:
- Company standard object definitions
- Relationships with contacts and opportunities
- Company-specific fields and metadata

**Use Cases**:
- Store company information
- Link contacts to companies
- Track company-level activities

---

### Person Module

**Purpose**: Manages person/contact entities in the CRM.

**Location**: `src/modules/person/`

**Features**:
- Person standard object definitions
- Contact information management
- Relationships with companies and opportunities

**Use Cases**:
- Store contact information
- Track contact interactions
- Manage contact relationships

---

### Opportunity Module

**Purpose**: Manages sales opportunities and pipeline stages.

**Location**: `src/modules/opportunity/`

**Features**:
- Opportunity standard object definitions
- Pipeline stage management
- Revenue and probability tracking

**Use Cases**:
- Track sales pipeline
- Forecast revenue
- Manage deal stages

---

### Task Module

**Purpose**: Manages tasks and to-do items.

**Location**: `src/modules/task/`

**Features**:
- Task standard object definitions
- Due dates and assignments
- Task status tracking

**Use Cases**:
- Create and assign tasks
- Track completion status
- Set reminders and due dates

---

### Note Module

**Purpose**: Manages notes and text annotations.

**Location**: `src/modules/note/`

**Features**:
- Rich text note storage
- Association with any record type
- Note sharing and permissions

**Use Cases**:
- Add notes to contacts or deals
- Document meeting outcomes
- Share information with team

---

### Attachment Module

**Purpose**: Manages file attachments and uploads.

**Location**: `src/modules/attachment/`

**Features**:
- File upload handling
- Storage integration (local, S3, etc.)
- Association with any record type

**Use Cases**:
- Upload documents to records
- Store contracts and agreements
- Share files with team members

---

## Supporting Modules

### Timeline Module

**Purpose**: Displays chronological activity timeline for records.

**Location**: `src/modules/timeline/`

**Features**:
- Aggregates activities across modules
- Displays emails, tasks, notes chronologically
- Filterable and searchable timeline

**Use Cases**:
- View all interactions with a contact
- Track deal progression history
- Audit record changes

---

### Dashboard Module

**Purpose**: Manages dashboard widgets and analytics.

**Location**: `src/modules/dashboard/`

**Features**:
- Widget management
- Dashboard layouts
- Data visualization

**Use Cases**:
- Display key metrics
- Create custom dashboards
- Track KPIs

---

### Blocklist Module

**Purpose**: Manages blocked contacts and domains for calendar and messaging.

**Location**: `src/modules/blocklist/`

**Features**:
- Block specific email addresses or domains
- Prevent sync from blocked sources
- Shared blocklist across workspace

**Use Cases**:
- Block spam contacts
- Exclude internal emails from sync
- Filter unwanted calendar invites

---

### Contact Creation Manager Module

**Purpose**: Automates contact creation from emails and calendar events.

**Location**: `src/modules/contact-creation-manager/`

**Features**:
- Automatic contact creation from email participants
- De-duplication logic
- Smart contact matching

**Use Cases**:
- Auto-create contacts from email threads
- Populate CRM from calendar meetings
- Reduce manual data entry

---

### Match Participant Module

**Purpose**: Matches email/calendar participants with existing contacts.

**Location**: `src/modules/match-participant/`

**Features**:
- Email-based matching
- Fuzzy name matching
- Conflict resolution

**Use Cases**:
- Link email participants to CRM contacts
- Match calendar attendees to people records
- Resolve duplicate contacts

---

### Workspace Member Module

**Purpose**: Manages workspace members and their permissions.

**Location**: `src/modules/workspace-member/`

**Features**:
- Member management
- Role and permission assignments
- Member activity tracking

**Use Cases**:
- Add team members to workspace
- Assign roles and permissions
- Track member activity

---

## Module Relationships

```
┌─────────────────────────────────────────────────────────┐
│                     ModulesModule                        │
└─────────────────────────────────────────────────────────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          ▼                ▼                ▼
  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
  │   Calendar   │  │  Messaging   │  │  Workflow    │
  │   Module     │  │   Module     │  │   Module     │
  └──────────────┘  └──────────────┘  └──────────────┘
          │                │                │
          └────────────────┼────────────────┘
                           │
                           ▼
                ┌──────────────────────┐
                │  ConnectedAccount    │
                │      Module          │
                └──────────────────────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          ▼                ▼                ▼
  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
  │   Person     │  │   Company    │  │ Opportunity  │
  │   Module     │  │   Module     │  │   Module     │
  └──────────────┘  └──────────────┘  └──────────────┘
```

## Common Patterns

### Module Structure

Most modules follow this standard structure:

```
module-name/
├── module-name.module.ts     # Main module definition
├── services/                 # Business logic services
├── listeners/                # Event listeners
├── jobs/                     # Background jobs (cron)
├── query-hooks/              # Database query hooks
├── standard-objects/         # Standard object definitions
├── types/                    # TypeScript types
├── utils/                    # Utility functions
└── constants/                # Module constants
```

### Service Layer

Services contain the core business logic and are exported for use by other modules. Example:

```typescript
@Injectable()
export class MyService {
  constructor(
    private readonly workspaceDataSourceService: WorkspaceDataSourceService,
  ) {}

  async doSomething(): Promise<Result> {
    // Business logic here
  }
}
```

### Listeners

Listeners respond to events from other parts of the system:

```typescript
@Injectable()
export class MyListener {
  @OnEvent('entity.created')
  async handleEntityCreated(payload: EntityCreatedEvent) {
    // Handle event
  }
}
```

### Background Jobs

Background jobs run on schedules or in response to queue events:

```typescript
@Processor(MessageQueue.cronQueue)
export class MyJob {
  @Process(MyJobPattern)
  async process(job: Job<MyJobData>) {
    // Job execution logic
  }
}
```

## Integration Points

### Database Access

Modules access the database through:
- **TypeORM repositories** for core tables
- **WorkspaceDataSourceService** for workspace-specific tables
- **ObjectMetadataEntity** for dynamic object access

### GraphQL API

Modules expose GraphQL APIs through:
- **Standard object definitions** (automatic CRUD)
- **Custom resolvers** for complex operations
- **Query hooks** for authorization and validation

### Message Queue

Modules communicate asynchronously via:
- **BullMQ queues** for job processing
- **Event emitters** for real-time events
- **Cron jobs** for scheduled tasks

## Best Practices

1. **Follow the modular approach**: Each module should have a single, well-defined responsibility
2. **Export services**: Make services available to other modules through the `exports` array
3. **Use dependency injection**: Leverage NestJS DI for loose coupling
4. **Implement listeners**: Use event-driven architecture for cross-module communication
5. **Define standard objects**: Use the standard object system for consistent data models
6. **Add query hooks**: Implement authorization and validation at the data layer
7. **Create background jobs**: Use jobs for long-running or scheduled operations
8. **Write tests**: Include unit and integration tests for all services
9. **Document types**: Use TypeScript interfaces and types for type safety
10. **Handle errors**: Implement proper error handling and logging

## Testing Modules

Each module should include:
- **Unit tests** for services and utilities
- **Integration tests** for complex workflows
- **E2E tests** for API endpoints

Run tests:
```bash
npx nx test twenty-server                          # Unit tests
npx nx run twenty-server:test:integration:with-db-reset  # Integration tests
```

## Adding a New Module

To add a new module:

1. Create module directory: `src/modules/my-module/`
2. Create module file: `my-module.module.ts`
3. Add services, listeners, jobs as needed
4. Export module in `modules.module.ts`
5. Define standard objects if needed
6. Add tests
7. Document the module

Example module:

```typescript
import { Module } from '@nestjs/common';

@Module({
  imports: [],
  providers: [MyService],
  exports: [MyService],
})
export class MyModule {}
```

<ArticleEditContent></ArticleEditContent>
